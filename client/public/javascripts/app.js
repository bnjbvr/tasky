!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},o={},i=function(t,e){return{}.hasOwnProperty.call(t,e)},n=function(t,e){var o,i,n=[];o=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var r=0,s=o.length;s>r;r++)i=o[r],".."===i?n.pop():"."!==i&&""!==i&&n.push(i);return n.join("/")},r=function(t){return t.split("/").slice(0,-1).join("/")},s=function(e){return function(o){var i=r(e),s=n(i,o);return t.require(s,e)}},a=function(t,e){var i={id:t,exports:{}};return o[t]=i,e(i.exports,s(t),i),i.exports},l=function(t,r){var s=n(t,".");if(null==r&&(r="/"),i(o,s))return o[s].exports;if(i(e,s))return a(s,e[s]);var l=n(s,"./index");if(i(o,l))return o[l].exports;if(i(e,l))return a(l,e[l]);throw new Error('Cannot find module "'+t+'" from "'+r+'"')},c=function(t,o){if("object"==typeof t)for(var n in t)i(t,n)&&(e[n]=t[n]);else e[t]=o},u=function(){var t=[];for(var o in e)i(e,o)&&t.push(o);return t};t.require=l,t.require.define=c,t.require.register=c,t.require.list=u,t.require.brunch=!0}}(),require.register("application",function(t,e,o){o.exports={initialize:function(){var t,o,i;this.locale=window.locale,delete window.locale,this.polyglot=new Polyglot({locale:this.locale});try{i=e("locales/"+this.locale)}catch(n){o=n,i=e("locales/en")}return this.polyglot.extend(i),window.t=this.polyglot.t.bind(this.polyglot),t=e("router"),this.router=new t,Backbone.history.start(),"function"==typeof Object.freeze?Object.freeze(this):void 0}}}),require.register("collections/archived_tasks",function(t,e,o){var i,n,r={}.hasOwnProperty,s=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};n=e("./tasks"),o.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.comparator=function(t,e){return t.get("completionDate")>e.get("completionDate")?-1:t.get("completionDate")===e.get("completionDate")?0:1},e}(n)}),require.register("collections/tags",function(t,e,o){var i,n={}.hasOwnProperty,r=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};o.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.comparator=function(t,e){return t.get("count")>e.get("count")?-1:t.get("count")===e.get("count")?t.get("id")<e.get("id")?-1:t.get("id")>e.get("id")?1:0:1},e.extractFromTasks=function(t,o,i){var n;return null==o&&(o=[]),null==i&&(i=[]),n=new e,t.pluck("tags").forEach(function(t){return t.forEach(function(t){var e;return t=t.toLowerCase(),_.contains(o,t)?void 0:(null==n.get(t)&&n.add(new Backbone.Model({id:t,count:0,selectIndex:i.indexOf(t)})),e=n.get(t),e.set("count",e.get("count")+1))})}),n.sort(),n},e}(Backbone.Collection)}),require.register("collections/tasks",function(t,e,o){var i,n,r,s={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};i=e("./tags"),n=e("../models/task"),o.exports=r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.url="tasks",e.prototype.model=n,e.prototype.comparator=function(t,e){return t.get("order")<e.get("order")?-1:t.get("order")===e.get("order")?0:1},e.prototype.getNewOrder=function(t,e){var o,i,n,r;return r=null!=e?e.get("order"):Number.MAX_VALUE,o=null!=t?t.get("order"):0,n=(r-o)/2,i=o+n,{order:i,step:n}},e.prototype.getAllTags=function(){return i.extractFromTasks(this)},e.prototype.getByTags=function(t){return void 0===t||null===t?this:0===t.length?new BackboneProjections.Filtered(this,{filter:function(t){return 0===t.get("tags").length}}):new BackboneProjections.Filtered(this,{filter:function(e){return e.containsTags(t)}})},e.prototype.reindex=function(){return this.trigger("reindexing"),$.ajax("tasks/reindex",{method:"POST",success:function(t){return function(e){return e.forEach(function(e){return t.get(e.id).set("order",e.order)}),t.trigger("reindexed")}}(this),error:function(t){return this.trigger("reindexed",t)}})},e}(Backbone.Collection)}),require.register("initialize",function(t,e){var o;o=e("application"),$(function(){return $.fn.spin=function(t,e){var o;return o={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:1,width:2,radius:4},medium:{lines:10,length:4,width:3,radius:6},large:{lines:10,length:8,width:4,radius:8},extralarge:{lines:8,length:3,width:10,radius:20,top:30,left:50}},"undefined"!=typeof Spinner&&null!==Spinner?this.each(function(){var i,n;return i=$(this),n=i.data("spinner"),null!=n?(n.stop(),i.data("spinner",null)):t!==!1?("string"==typeof t&&(t=t in o?o[t]:{},e&&(t.color=e)),n=new Spinner(t),n.spin(this),i.data("spinner",n)):void 0}):void 0},o.initialize()})}),require.register("lib/base_view",function(t,e,o){var i,n={}.hasOwnProperty,r=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};o.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.template=function(){},e.prototype.initialize=function(){},e.prototype.getRenderData=function(){var t;return{model:null!=(t=this.model)?t.toJSON():void 0}},e.prototype.render=function(){return this.beforeRender(),this.$el.html(this.template(this.getRenderData())),this.afterRender(),this},e.prototype.beforeRender=function(){},e.prototype.afterRender=function(){},e.prototype.destroy=function(){return this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this)},e}(Backbone.View)}),require.register("lib/utils",function(t,e,o){o.exports.buildTagsList=function(t,e){var o,i,n,r;return null==e&&(e={}),n=e.tagPrefix||"",i=e.regularSeparator||" ",o=e.lastSeparator||" ",null==t?"":(r="",t.forEach(function(e){return r=0===t.indexOf(e)?""+n+e:t.indexOf(e)===t.length-1?""+r+o+n+e:""+r+i+n+e}),r)}}),require.register("lib/view_collection",function(t,e,o){var i,n,r=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};i=e("lib/base_view"),o.exports=n=function(t){function e(){return this.removeItem=r(this.removeItem,this),this.addItem=r(this.addItem,this),e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.itemview=null,e.prototype.views={},e.prototype.template=function(){return""},e.prototype.itemViewOptions=function(){},e.prototype.collectionEl=null,e.prototype.onChange=function(){return this.$el.toggleClass("empty",0===_.size(this.views))},e.prototype.appendView=function(t){return this.$collectionEl.append(t.el)},e.prototype.initialize=function(){var t;return e.__super__.initialize.apply(this,arguments),this.views={},this.listenTo(this.collection,"reset",this.onReset),this.listenTo(this.collection,"add",this.addItem),this.listenTo(this.collection,"remove",this.removeItem),null==this.collectionEl?t=el:void 0},e.prototype.render=function(){var t,o,i;i=this.views;for(t in i)o=i[t],o.$el.detach();return e.__super__.render.apply(this,arguments)},e.prototype.afterRender=function(){var t,e,o;this.$collectionEl=$(this.collectionEl),o=this.views;for(t in o)e=o[t],this.appendView(e.$el);return this.onReset(this.collection),this.onChange(this.views)},e.prototype.remove=function(){return this.onReset([]),e.__super__.remove.apply(this,arguments)},e.prototype.onReset=function(t){var e,o,i;i=this.views;for(e in i)o=i[e],o.remove();return t.forEach(this.addItem)},e.prototype.addItem=function(t){var e,o;return e=_.extend({},{model:t},this.itemViewOptions(t)),o=new this.itemView(e),this.views[t.cid]=o.render(),this.appendView(o),this.onChange(this.views)},e.prototype.removeItem=function(t){return this.views[t.cid].remove(),delete this.views[t.cid],this.onChange(this.views)},e}(i)}),require.register("locales/en",function(t,e,o){o.exports={todo:"To-do",archived:"Archived",untagged:"untagged","all tasks":"All tasks","all archived tasks":"All archived tasks","untagged tasks":"Untagged tasks","tasks of":"Tasks related to %{tagsList}","archived tasks of":"Archived tasks related to %{tagsList}",and:"and","archived date format":"{yyyy}/{MM}{dd} at {HH}:{mm}","actions headline":"Actions","completed headline":"Completed on","restore button":"Restore","restore button?":"Restore?","done button":"Done","done button?":"Done?","todo button":"Todo","todo button?":"Todo?","new button":"New","archive button":"Archive all done tasks","form headline tags":"What's next about %{tagsList}?","form headline":"What's next?","reindexing message":"Server is reindexing all the tasks, please wait a little..."}}),require.register("locales/fr",function(t,e,o){o.exports={todo:"A faire",archived:"Archivées",untagged:"sans étiquette","all tasks":"Toutes les tâches","all archived tasks":"Toutes les tâches archivées","untagged tasks":"Tâches sans étiquettes","tasks of":"Tâches correspondant à l'étiquette %{tagsList} |||| Tâches correspondant aux étiquettes %{tagsList}","archived tasks of":"Tâches archivées correspondant à l'étiquette %{tagsList} |||| Tâches archivées correspondant aux étiquettes %{tagsList}",and:"et","archived date format":"{dd}/{MM}/{yyyy} à {HH}h{mm}","actions headline":"Actions","completed headline":"Complétée le","restore button":"Restaurer","restore button?":"Restaurer ?","done button":"Fait","done button?":"Fait ?","todo button":"A faire","todo button?":"A faire ?","new button":"Ajouter","archive button":"Archiver toutes les tâches faites","form headline tags":"Que devez-vous faire à propos de %{tagsList} ?","form headline":"Que devez-vous faire ?","reindexing message":"Le serveur est en train de ré-indexer les tâches, merci de patienter..."}}),require.register("models/task",function(t,e,o){var i,n={}.hasOwnProperty,r=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};o.exports=i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.set=function(t,o){var i;return e.__super__.set.call(this,t,o),"description"===t?(i=e.extractTags(this.get("description")),this.set("tags",i)):void 0},e.prototype.containsTags=function(t){return t instanceof Array||(t=[t]),0===t.length?0===this.get("tags").length:_.every(t,_.partial(_.contains,this.get("tags")))},e.prototype.getPreviousWithTags=function(t){var e,o,i,n;return i=this.get("order"),n=this.collection.getByTags(t),o=n.find(function(e){return null!=t&&e.get("order")>i&&e.containsTags(t)||null==t&&e.get("order")>i}),e=n.indexOf(o),-1===e?_.last(n.toArray()):n.at(e-1)},e.regex=/#([\w\d\-_\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/g,e.extractTags=function(t){var o;return o=t.match(e.regex),o=_.unique(o),o=_.map(o,function(t){return t.replace("#","")})},e}(Backbone.Model)}),require.register("router",function(t,e,o){var i,n,r,s,a,l,c,u,d={}.hasOwnProperty,p=function(t,e){function o(){this.constructor=t}for(var i in e)d.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};i=e("views/app_view"),s=e("views/menu_view"),u=e("views/task_list_view"),r=e("views/archive_list_view"),c=e("collections/tasks"),n=e("collections/archived_tasks"),l=e("models/task"),o.exports=a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.routes={"":"main",archived:"archived","todoByTags/*tags":"todoByTags","archivedByTags/*tags":"archivedByTags"},e.prototype.initialize=function(){return this.collection=new c(initTasks),this.archivedCollection=new n(archivedTasks),this.mainView=new i,this.mainView.render(),this.menu=new s({baseCollection:this.collection,archivedCollection:this.archivedCollection}),this.taskList=new u({baseCollection:this.collection}),this.listenTo(this.taskList,"archive-tasks",function(t){return function(e){return t.collection.remove(e),t.archivedCollection.add(e),t.taskList.render()}}(this)),this.archivedTaskList=new r({baseCollection:this.archivedCollection}),this.listenTo(this.archivedTaskList,"restore-task",function(t){return function(e){return t.archivedCollection.remove(e),t.collection.add(e),t.archivedTaskList.render()}}(this))},e.prototype.main=function(){return this.taskList.setTags(null),this.taskList.render(),this.menu.setViewType("#tobedone"),this.menu.setActive(null),this.menu.render()},e.prototype.archived=function(){return this.archivedTaskList.setTags(null),this.archivedTaskList.render(),this.menu.setViewType("#archived"),this.menu.setActive(null),this.menu.render()},e.prototype.byTags=function(t,e,o){return null!=o?(o=o.split("/"),0===o[o.length-1].length&&delete o[o.length-1]):o=[],e.setTags(o),e.render(),this.menu.setViewType(t),this.menu.setActive(o),this.menu.render()},e.prototype.todoByTags=function(t){return this.byTags("#tobedone",this.taskList,t)},e.prototype.archivedByTags=function(t){return this.byTags("#archived",this.archivedTaskList,t)},e}(Backbone.Router)}),require.register("views/app_view",function(t,e,o){var i,n,r,s,a={}.hasOwnProperty,l=function(t,e){function o(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};n=e("../lib/base_view"),r=e("./menu_view"),s=e("./task_list_view"),o.exports=i=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return l(o,t),o.prototype.el="body",o.prototype.template=e("./templates/home"),o}(n)}),require.register("views/archive_list_view",function(e,o,i){var n,r,s,a,l,c,u={}.hasOwnProperty,d=function(t,e){function o(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};s=o("../lib/base_view"),c=o("../lib/utils"),a=o("../models/task"),r=o("./archive_task_view"),l=o("./task_form_view"),i.exports=n=function(e){function i(t){this.baseCollection=t.baseCollection,this.views=new Backbone.ChildViewContainer,i.__super__.constructor.call(this,t)}return d(i,e),i.prototype.el=".container",i.prototype.template=o("./templates/task_list_archive"),i.prototype.views=null,i.prototype.collectionEl="ul#task-list",i.prototype.setTags=function(t){return this.selectedTags=t,null!=this.collection&&(this.stopListening(this.collection),delete this.collection),this.collection=this.baseCollection.getByTags(this.selectedTags),this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"change",function(t){return function(e){var o;return(null!=e?e.get("isArchived"):void 0)?void 0:(o=t.views.findByModel(e),o.$el.fadeOut(function(){return t.stopListening(o),t.views.remove(o),o.destroy(),t.trigger("restore-task",e)}))}}(this))},i.prototype.getRenderData=function(){return{title:this.getTitle()}},i.prototype.beforeRender=function(){return this.views.forEach(function(t){return function(e){return-1!==t.collection.indexOf(e.model)?e.$el.detach():(t.stopListening(e),t.views.remove(e),e.destroy())}}(this))},i.prototype.afterRender=function(){return this.collection.forEach(function(t){return function(e){var o;return o=t.views.findByModel(e),null==o?(o=new r({model:e}),t.views.add(o)):o.delegateEvents(),$(t.collectionEl).append(o.render().$el)}}(this)),this.$el},i.prototype.getTitle=function(){var e;return this.collection.length===this.baseCollection.length?t("all archived tasks"):(e=c.buildTagsList(this.selectedTags,{tagPrefix:"#",regularSeparator:", ",lastSeparator:" "+t("and")+" "}),t("archived tasks of",{tagsList:e,smart_count:this.selectedTags.length}))},i}(s)}),require.register("views/archive_task_view",function(e,o,i){var n,r,s={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};r=o("./task_view"),i.exports=n=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return a(i,e),i.prototype.tagName="li",i.prototype.className="task archive done",i.prototype.template=o("./templates/task_archive"),i.prototype.getRenderData=function(){var e;return e=Date.create(this.model.get("completionDate")),_.extend(i.__super__.getRenderData.call(this),{competionDate:e.format(t("archived date format"))})},i.prototype.afterRender=function(){},i.prototype.onClick=function(){return this.model.set("done",!1),this.model.set("completionDate",null),this.model.set("isArchived",!1),this.model.save(),this.render()},i.prototype.onMouseEnter=function(){var e;return e=this.$("button"),this.model.get("done")?(e.prop("title",t("restore button?")),e.html(t("restore button?"))):void 0},i.prototype.onMouseLeave=function(){var e;return e=this.$("button"),this.model.get("done")?e.html(t("done button")):void 0},i}(r)}),require.register("views/menu_item_view",function(t,e,o){var i,n,r,s={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};i=e("../lib/base_view"),r=e("../collections/tags"),o.exports=n=function(t){function o(t){this.baseCollection=t.baseCollection,this.archivedCollection=t.archivedCollection,this.selectedTags=t.selectedTags,this.depth=t.depth,this.viewType=t.viewType,this.views=new Backbone.ChildViewContainer,o.__super__.constructor.call(this,t)}return a(o,t),o.prototype.tagName="li",o.prototype.className="menu-tag",o.prototype.template=e("./templates/menu_item"),o.prototype.collectionEl="ul.submenu",o.prototype.views=null,o.prototype.events={click:"onClick"},o.prototype.getRenderData=function(){var t;return t=o.__super__.getRenderData.call(this),_.extend(t,{url:this.buildUrl()}),t},o.prototype.buildUrl=function(){var t,e,o,i,n,r,s,a;return o=(null!=(n=this.selectedTags)?n.slice(0,this.depth):void 0)||[],t=null!=(r=this.selectedTags)?r.indexOf(this.model.get("tagName")):void 0,_.contains(o,this.model.get("tagName"))&&!((null!=(s=this.selectedTags)?s.length:void 0)>this.depth+1)||t+1===(null!=(a=this.selectedTags)?a.length:void 0)&&this.depth===t||o.push(this.model.get("tagName")),"#tobedone"===this.viewType?(i="#",e="todoByTags"):(i="#archived",e="archivedByTags"),o.length>0&&(i="#"+e,o.forEach(function(t){return i=""+i+"/"+t})),i},o.prototype.beforeRender=function(){return this.model.get("isMagic")?this.$el.addClass("magic"):void 0},o.prototype.afterRender=function(){var t,e,i,n;return t=null!=(n=this.selectedTags)?n.indexOf(this.model.get("tagName")):void 0,t===this.depth&&(this.$el.addClass("active"),this.depth+1===this.selectedTags.length&&this.$el.addClass("selected")),e=25*(this.depth+1),this.$("a").css("padding-left",e),null!=this.selectedTags&&this.selectedTags[this.depth]===this.model.get("tagName")?(i=this.buildTagsList(),i.forEach(function(t){return function(e){var i;return i=new o({model:new Backbone.Model({tagName:e.get("id"),count:e.get("count")}),selectedTags:t.selectedTags,depth:t.depth+1,viewType:t.viewType,baseCollection:t.baseCollection,archivedCollection:t.archivedCollection}),t.views.add(i),t.$el.children(t.collectionEl).append(i.render().$el)}}(this))):void 0},o.prototype.buildTagsList=function(){var t,e,o,i;return e=this.selectedTags||[],e=e.slice(0,this.depth+1),o=this.selectedTags||[],o=o.slice(0,this.depth+1),null!=this.collection&&delete this.collection,t="#tobedone"===this.viewType?this.baseCollection:this.archivedCollection,this.collection=t.getByTags(o),i=r.extractFromTasks(this.collection,e,this.selectedTags)},o}(i)}),require.register("views/menu_view",function(e,o,i){var n,r,s,a={}.hasOwnProperty,l=function(t,e){function o(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};n=o("../lib/base_view"),r=o("./menu_item_view"),i.exports=s=function(e){function i(t){this.baseCollection=t.baseCollection,this.archivedCollection=t.archivedCollection,this.views=new Backbone.ChildViewContainer,i.__super__.constructor.call(this,t)}return l(i,e),i.prototype.el="#menu",i.prototype.template=o("./templates/menu"),i.prototype.views=null,i.prototype.collectionEl="ul.tags",i.prototype.activeTags=null,i.prototype.subMenuHandler=null,i.prototype.initialize=function(t){return this.listenTo(this.baseCollection,{add:this.onChange,change:this.onChange,remove:this.onChange}),this.listenTo(this.archivedCollection,{add:this.onChange,change:this.onChange,remove:this.onChange}),i.__super__.initialize.call(this,t)},i.prototype.getRenderData=function(){var t;return t=this.archivedCollection.length>1e3?"Over 9000++":this.archivedCollection.length,{allCount:this.baseCollection.length,untaggedCount:this.baseCollection.filter(function(t){return 0===t.get("tags").length}).length,archivedCount:t}},i.prototype.beforeRender=function(){var t;return t=this.baseCollection.getAllTags(),this.views.forEach(function(e){return function(o){return-1!==t.indexOf(o.model.get("tagName"))?o.$el.detach():(e.stopListening(o),e.views.remove(o),o.destroy())}}(this))},i.prototype.afterRender=function(){var e,i,n,s,a,l,c,u,d,p,h;return c=this.$(""+this.viewType),s=this.$(""+this.viewType+" > .submenu"),this.collection="#tobedone"===this.viewType?this.baseCollection:this.archivedCollection,u=this.collection.filter(function(t){return 0===t.get("tags").length}).length,u>0&&(l=o("./templates/menu_item"),n="#tobedone"===this.viewType?"todoByTags":"archivedByTags",i=0===(null!=(h=this.activeTags)?h.length:void 0)?" active selected":"",d=$('<li class="menu-tag magic'+i+'"></li>'),p=l({url:"#"+n+"/",model:{tagName:t("untagged"),count:u}}),d.append(p),s.append(d)),"#tobedone"===this.viewType&&(e=this.$("#archived"),this.$("ul:first-child").prepend(e)),a=this.collection.getAllTags(),a.forEach(function(t){return function(e){var o;return o=new r({model:new Backbone.Model({tagName:e.get("id"),count:e.get("count"),isMagic:e.get("isMagic")}),selectedTags:t.activeTags,depth:0,viewType:t.viewType,baseCollection:t.baseCollection,archivedCollection:t.archivedCollection}),t.views.add(o),s.append(o.render().$el)}}(this)),c.addClass("active"),null==this.activeTags&&c.addClass("selected"),this.$el},i.prototype.onChange=function(){return this.render()},i.prototype.setActive=function(t){return this.activeTags=t},i.prototype.setViewType=function(t){return this.viewType=t},i}(n)}),require.register("views/task_form_view",function(e,o,i){var n,r,s,a,l={}.hasOwnProperty,c=function(t,e){function o(){this.constructor=t}for(var i in e)l.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},u=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};n=o("../lib/base_view"),a=o("../lib/utils"),s=o("./task_view"),i.exports=r=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return c(i,e),i.prototype.el="#new-task",i.prototype.template=o("./templates/task_form"),i.prototype.events={"keydown input":"onKeydown","keyup input":"onKeyup","blur input":"onSubmit","click button":"onSubmit"},i.prototype.initialize=function(t){return i.__super__.initialize.call(this),this.tags=t.tags},i.prototype.onKeydown=function(t){var e,o,i,n,r;return i=t.keyCode||t.charCode,o=this.$("input").val(),r=a.buildTagsList(this.tags,{tagPrefix:"#"}),""!==r&&(r=""+r+" "),n=[8,32,9,13,38,40,37,39],e=[220,86],0===o.length&&u.call(n,i)<0&&(!(t.metaKey||t.ctrlKey||t.altKey)||u.call(e,i)>=0)?(this.$("input").val(r),o=r):void 0},i.prototype.onKeyup=function(t){var e,o;return o=t.keyCode||t.charCode,e=this.$("input").val(),0===e.length?this.$("button").addClass("disabled"):this.$("button").removeClass("disabled"),13===o&&this.onSubmit(),40===o?this.trigger("focus-down"):void 0},i.prototype.onSubmit=function(){var t;return t=this.$("input").val(),t.length>0?this.trigger("new-task-submitted",{content:t}):void 0},i.prototype.getRenderData=function(){return{formPlaceholder:this.getFormPlaceholder()}},i.prototype.getFormPlaceholder=function(){var e;return e=a.buildTagsList(this.tags,{tagPrefix:"#",regularSeparator:", ",lastSeparator:" "+t("and")+" "}),e.length>0?t("form headline tags",{tagsList:e}):t("form headline")},i}(n)}),require.register("views/task_list_view",function(e,o,i){var n,r,s,a,l,c,u={}.hasOwnProperty,d=function(t,e){function o(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};n=o("../lib/base_view"),c=o("../lib/utils"),r=o("../models/task"),l=o("./task_view"),s=o("./task_form_view"),i.exports=a=function(e){function i(t){this.baseCollection=t.baseCollection,this.views=new Backbone.ChildViewContainer,i.__super__.constructor.call(this,t)}return d(i,e),i.prototype.el=".container",i.prototype.template=o("./templates/task_list"),i.prototype.views=null,i.prototype.collectionEl="ul#task-list",i.prototype.isReindexing=!1,i.prototype.events={"click #archive-action":"onArchiveClicked","click h1":"reindex"},i.prototype.reindex=function(){return this.baseCollection.reindex()},i.prototype.initialize=function(){return this.listenTo(this.baseCollection,"reindexing",function(){return this.isReindexing=!0,$("#block").show(),$("#modal").show()}),this.listenTo(this.baseCollection,"reindexed",function(t){return this.isReindexing=!1,$("#block").hide(),$("#modal").hide(),null!=t?console.log(t):void 0})},i.prototype.setTags=function(t){return this.selectedTags=t,null!=this.collection&&(this.stopListening(this.collection),delete this.collection),this.collection=this.baseCollection.getByTags(this.selectedTags),this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",function(t){return function(e){var o;return o=e.getPreviousWithTags(t.selectedTags),null!=o&&(t.taskModelCIDToFocus=o.cid),t.render()}}(this)),this.listenTo(this.collection,"change",function(t){return function(){return t.updateArchiveButtonState()}}(this))},i.prototype.getRenderData=function(){return{title:this.getTitle()}},i.prototype.beforeRender=function(){return this.views.forEach(function(t){return function(e){return-1!==t.collection.indexOf(e.model)?e.$el.detach():(t.stopListening(e),t.views.remove(e),e.destroy())}}(this))},i.prototype.afterRender=function(){var t;return this.updateArchiveButtonState(),null!=this.taskForm&&(this.stopListening(this.taskForm),this.taskForm.destroy()),this.taskForm=new s({tags:this.selectedTags}),this.listenTo(this.taskForm,"new-task-submitted",this.createNewTask),this.listenTo(this.taskForm,"focus-down",this.onFocusDown),this.taskForm.render(),this.collection.forEach(function(t){return function(e){var o;return o=t.views.findByModel(e),null==o?(o=new l({model:e}),t.views.add(o),t.listenTo(o,"new-task-submitted",t.createNewTask),t.listenTo(o,"focus-up",t.onFocusUp),t.listenTo(o,"focus-down",t.onFocusDown),t.listenTo(o,"move-up",t.onMoveUp),t.listenTo(o,"move-down",t.onMoveDown)):o.delegateEvents(),$(t.collectionEl).append(o.render().$el)}}(this)),null!=this.taskModelCIDToFocus?(t=this.views.findByModelCid(this.taskModelCIDToFocus),null!=t?t.setFocus():(console.log("something went wrong trying to focus"),this.taskForm.$el.find("input").focus()),this.taskModelCIDToFocus=null):this.taskForm.$el.find("input").focus(),this.$el},i.prototype.getTitle=function(){var e;return this.collection.length===this.baseCollection.length?t("all tasks"):null!=this.selectedTags&&0===this.selectedTags.length?t("untagged tasks"):(e=c.buildTagsList(this.selectedTags,{tagPrefix:"#",regularSeparator:", ",lastSeparator:" "+t("and")+" "}),t("tasks of",{tagsList:e,smart_count:this.selectedTags.length}))},i.prototype.createNewTask=function(t){var e,o,i,n,s,a,l,u,d,p;return null==t&&(t={}),this.isReindexing?void 0:(u=c.buildTagsList(this.selectedTags,{tagPrefix:"#"}),""!==u&&(u=""+u+" "),e=t.content||u,null!=t.previous?(a=this.views.findByModelCid(t.previous).model,n=this.baseCollection.indexOf(a)+1,i=this.baseCollection.at(n),s=this.baseCollection.getNewOrder(a,i),o=n):(i=this.baseCollection.at(0),p=this.baseCollection.getNewOrder(null,i),s=p.order,l=p.step,o=0),d=new r({description:e,order:s,tags:r.extractTags(e)}),this.taskModelCIDToFocus=null!=t.previous?d.cid:null,this.baseCollection.create(d,{at:o}),this.checkIfReindexationIsNeeded(l))},i.prototype.onFocusUp=function(t){var e,o,i;return e=this.views.findByModelCid(t).model,o=this.collection.indexOf(e)-1,i=this.collection.at(o),o>=0?this.views.findByModel(i).setFocus():this.taskForm.$el.find("input").focus()},i.prototype.onFocusDown=function(t){var e,o,i;return null!=t?(e=this.views.findByModelCid(t).model,o=this.collection.indexOf(e)+1,i=this.collection.at(o)):(o=0,i=this.collection.at(o)),o<this.views.length?this.views.findByModel(i).setFocus():void 0},i.prototype.onMoveUp=function(t,e){var o,i,n,r,s,a,l;return null==e&&(e=null),this.isReindexing?void 0:(o=this.views.findByModelCid(t).model,s=this.baseCollection.indexOf(o)-1,r=this.baseCollection.at(s),a=this.baseCollection.at(s-1)||null,s>=0?(i=this.baseCollection.getNewOrder(a,r),n=i.order,l=i.step,o.set("order",n),o.save(),this.baseCollection.sort(),this.taskModelCIDToFocus=null!=e?e:t,this.render(),this.checkIfReindexationIsNeeded(l)):void 0)},i.prototype.onMoveDown=function(t){var e,o,i,n,r,s,a;if(!this.isReindexing)return e=this.views.findByModelCid(t).model,i=this.baseCollection.indexOf(e)+1,n=this.baseCollection.at(i),r=this.baseCollection.at(i+1)||null,i!==this.baseCollection.length?(o=this.baseCollection.getNewOrder(n,r),s=o.order,a=o.step,e.set("order",s),e.save(),this.baseCollection.sort(),this.taskModelCIDToFocus="undefined"!=typeof toFocus&&null!==toFocus?toFocus:t,this.render(),this.checkIfReindexationIsNeeded(a)):void 0},i.prototype.updateArchiveButtonState=function(){return this.collection.where({done:!0}).length>0?this.$("#archive-action").removeClass("disable"):this.$("#archive-action").addClass("disable")},i.prototype.onArchiveClicked=function(){var e,o,i,n;if(!this.isReindexing)return n=this.collection.where({done:!0}),o=n.length,e=0,o>0&&(this.$("#archive-action").html("&nbsp;"),this.$("#archive-action").spin("tiny","#fff")),i=function(i){return function(r){var s;return e++,s=i.views.findByModel(r),e===o?(i.stopListening(s),i.views.remove(s),s.$el.fadeOut(function(){return s.destroy(),i.$("#archive-action").html(t("archive button")),i.trigger("archive-tasks",n)})):(i.stopListening(s),i.views.remove(s),s.$el.fadeOut(function(){return s.destroy()}))}}(this),n.forEach(function(t){return t.set("isArchived",!0),t.once("sync",i),t.save()})},i.prototype.checkIfReindexationIsNeeded=function(t){var e,o;return o=Math.pow(10,8),e=Number.MAX_VALUE/(this.baseCollection.length+1),o>e&&(o=e),o>=t?this.baseCollection.reindex():void 0},i}(n)}),require.register("views/task_view",function(e,o,i){var n,r,s={}.hasOwnProperty,a=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};n=o("../lib/base_view"),i.exports=r=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return a(i,e),i.prototype.tagName="li",i.prototype.className="task",i.prototype.template=o("./templates/task"),i.prototype.events={"keydown  input":"onKeydown","keyup  input":"onKeyup","focus input":"onFocus","blur input":"onBlur","click button":"onClick","mouseenter button":"onMouseEnter","mouseleave button":"onMouseLeave"},i.prototype.getRenderData=function(){return{model:this.model.toJSON(),tabindex:this.model.collection.indexOf(this.model)+2}},i.prototype.afterRender=function(){return this.model.get("done")?(this.$el.addClass("done"),this.$("button").html(t("done button"))):this.$el.removeClass("done")
},i.prototype.onClick=function(){return this.model.set("done",!this.model.get("done")),this.model.get("done")?this.model.set("completionDate",Date.now()):this.model.set("completionDate",null),this.afterRender(),this.model.save(),this.render()},i.prototype.onKeydown=function(t){var e,o;return o=t.keyCode||t.charCode,e=t.controlKey||t.metaKey,""===this.$("input").val()&&8===o?(this.model.destroy(),t.preventDefault()):38===o&&e?this.trigger("move-up",this.model.cid):40===o&&e?this.trigger("move-down",this.model.cid):void 0},i.prototype.onKeyup=function(t){var e;return e=t.keyCode||t.charCode,13===e?(this.onBlur(),this.trigger("new-task-submitted",{content:"",previous:this.model.cid})):38===e?this.trigger("focus-up",this.model.cid):40===e?this.trigger("focus-down",this.model.cid):void 0},i.prototype.onFocus=function(){return this.focusInterval=setInterval(function(t){return function(){return t.saveDescription()}}(this),2e3)},i.prototype.onBlur=function(){return clearInterval(this.focusInterval),this.saveDescription()},i.prototype.saveDescription=function(){var t;return t=this.$("input").val(),t!==this.model.get("description")?(this.model.set("description",t),this.model.save()):void 0},i.prototype.setFocus=function(){var t,e;return e=this.$("input"),e.focus(),t=e.val().length,e[0].setSelectionRange(t,t)},i.prototype.onMouseEnter=function(){var e;return e=this.$("button"),this.model.get("done")?(e.attr("title",t("todo button?")),e.html(t("todo button?"))):(e.attr("title",t("done button?")),e.html(t("done button?")))},i.prototype.onMouseLeave=function(){var e;return e=this.$("button"),e.html(this.model.get("done")?t("done button"):t("todo button"))},i.prototype.destroy=function(){return clearTimeout(this.focusInterval),i.__super__.destroy.call(this)},i}(n)}),require.register("views/templates/home",function(e,o,i){var n=function(){var e,o=[];return o.push('<div id="menu"></div><div class="container"></div><div id="block"></div><div id="modal"><p>'+jade.escape(null==(e=t("reindexing message"))?"":e)+"</p></div>"),o.join("")};"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof i&&i&&i.exports&&(i.exports=n)}),require.register("views/templates/menu",function(e,o,i){var n=function(e){var o,i=[],n=e||{},r=n.allCount,s=n.archivedCount;return i.push('<ul><li id="tobedone" class="first-level"><a href="#">'+jade.escape(null==(o=t("todo"))?"":o)+" ("+jade.escape(null==(o=r)?"":o)+')</a><ul class="submenu"></ul></li><li id="archived" class="first-level"><a href="#archived">'+jade.escape(null==(o=t("archived"))?"":o)+" ("+jade.escape(null==(o=s)?"":o)+')</a><ul class="submenu"></ul></li></ul>'),i.join("")};"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof i&&i&&i.exports&&(i.exports=n)}),require.register("views/templates/menu_item",function(t,e,o){var i=function(t){var e,o=[],i=t||{},n=i.url,r=i.model;return o.push("<a"+jade.attr("href",""+n,!0,!1)+jade.attr("title",""+r.tagName,!0,!1)+'><i class="tag-icon"></i><span>'+jade.escape(null==(e=r.tagName)?"":e)+" ("+jade.escape(null==(e=r.count)?"":e)+')</span></a><ul class="submenu"></ul>'),o.join("")};"function"==typeof define&&define.amd?define([],function(){return i}):"object"==typeof o&&o&&o.exports&&(o.exports=i)}),require.register("views/templates/task",function(e,o,i){var n=function(e){var o,i=[],n=e||{},r=n.model,s=n.tabindex;return i.push('<div class="task-container"><button title="t(\'todo button\')" class="toggle-state button">'+jade.escape(null==(o=t("todo button"))?"":o)+'</button><div class="todo-field"><input'+jade.attr("value",""+r.description,!0,!1)+jade.attr("tabindex",""+s,!0,!1)+"/></div></div>"),i.join("")};"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof i&&i&&i.exports&&(i.exports=n)}),require.register("views/templates/task_archive",function(e,o,i){var n=function(e){var o,i=[],n=e||{},r=n.model,s=n.tabindex,a=n.competionDate;return i.push('<div class="task-container"><button'+jade.attr("title",""+t("done button"),!0,!1)+' class="toggle-state button">'+jade.escape(null==(o=t("done button"))?"":o)+'</button><div class="todo-field"><input'+jade.attr("value",""+r.description,!0,!1)+jade.attr("tabindex",""+s,!0,!1)+'/></div></div><div class="todo-completionDate"><p>'+jade.escape(null==(o=t("completed headline"))?"":o)+" "+jade.escape(null==(o=a)?"":o)+"</p></div>"),i.join("")};"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof i&&i&&i.exports&&(i.exports=n)}),require.register("views/templates/task_form",function(e,o,i){var n=function(e){var o,i=[],n=e||{},r=n.formPlaceholder;return i.push('<div class="task-container"><button class="toggle-state button disabled">'+jade.escape(null==(o=t("new button"))?"":o)+'</button><div class="todo-field"><input tabindex="1"'+jade.attr("placeholder",""+r,!0,!1)+"/></div></div>"),i.join("")};"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof i&&i&&i.exports&&(i.exports=n)}),require.register("views/templates/task_list",function(e,o,i){var n=function(e){var o,i=[],n=e||{},r=n.title;return i.push("<h1>"+jade.escape(null==(o=r)?"":o)+'</h1><p id="actions">'+jade.escape(null==(o=t("actions headline"))?"":o)+':<button id="archive-action" class="button disable">'+jade.escape(null==(o=t("archive button"))?"":o)+'</button></p><div id="new-task" class="task"></div><ul id="task-list"></ul>'),i.join("")};"function"==typeof define&&define.amd?define([],function(){return n}):"object"==typeof i&&i&&i.exports&&(i.exports=n)}),require.register("views/templates/task_list_archive",function(t,e,o){var i=function(t){var e,o=[],i=t||{},n=i.title;return o.push("<h1>"+jade.escape(null==(e=n)?"":e)+'</h1><ul id="task-list"></ul>'),o.join("")};"function"==typeof define&&define.amd?define([],function(){return i}):"object"==typeof o&&o&&o.exports&&(o.exports=i)});
//# sourceMappingURL=app.js.map